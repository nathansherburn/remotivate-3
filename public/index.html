<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body, html {
      position: fixed;
      height: 100%;
      width: 100%;
      padding: 0;
      margin: 0;
      background-color: #242222;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      -webkit-overflow-scrolling: touch;
      -webkit-user-select: none;  /* Chrome all / Safari all */
      -moz-user-select: none;     /* Firefox all */
      -ms-user-select: none;      /* IE 10+ */
      user-select: none;          /* Likely future */      
    }
    
    .top-buttons {
      position: fixed;
      height: 80px;
      width: 100%;
      background-color: #3b78e7;
      box-shadow: 0px 0px 10px #000;
      z-index: 100;
      font-size: 80px;
    }
    
    .top-buttons i { font-size: 40px; padding: 10px; }
    
    .app-list { display: flex; }

    .main { height: calc(100% - 80px); margin-top: 80px; }

    .pc-controls { display: flex; flex-direction: column; height: 100%; }
    
    .favorites-list { flex: 1; background-color: #fff; }
    
    .text-input {
      height: 80px;
      background-color: #333;
      box-shadow: 0px 0px 10px #000;
      z-index: 100;
    }
    
    .text-input input {
      width: 100%;
      height: 80px;
      font-size: 1em;
      color: #fff;
      padding: 20px;
      background-color: #333;
      outline: none;
      border: none;
    }
    
    .controls { height: 400px; display: flex; flex-direction: row; }
    
    .side-btns {
      width: 80px;
      display: flex;
      flex-direction: column;
    }
    .side-btns .btn {
      flex: 1;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .scroll { width: 80px; }
    .touch-pad { flex: 1; background-color: #333; }

  </style>
</head>

<body>
  
  <div class="top-buttons">
    <div style="display: flex; height: 100%; align-items: center;">
    <i id="apps" class="material-icons">&#xE5C3;</i>
    <!--<i id="controls" class="material-icons">&#xE312;</i>-->
    <span style="flex: 1;"></span>
    <i class="material-icons">&#xE04D;</i>
    <i class="material-icons">&#xE04F;</i>
    <i class="material-icons">&#xE050;</i>
    <i class="material-icons">&#xE8AC;</i>
    </div>
  </div>
  
  <div class="main">
    
    <div class="app-list">
      <input type="button" onclick="emit('open', {url: 'http://iview.abc.net.au/'})" value="iView">
      <input type="button" onclick="emit('open', {url: 'http://netflix.com/'})" value="Netflix">
      <input type="button" onclick="emit('open', {url: 'http://www.sbs.com.au/ondemand/'})" value="SBS On Demand">
      <input type="button" onclick="emit('open', {url: 'http://youtube.com/'})" value="YouTube">
      <input type="button" onclick="emit('open', {file: 'channels/SampleVideo_1280x720_1mb.mp4'})" value="10">
      <input type="button" onclick="emit('open', {file: 'channels/SampleVideo_1280x720_1mb.mp4'})" value="9">
      <input type="button" onclick="emit('open', {file: 'channels/SampleVideo_1280x720_1mb.mp4'})" value="7">
      <input type="button" onclick="emit('open', {file: 'channels/SampleVideo_1280x720_1mb.mp4'})" value="SBS">
      <input type="button" onclick="emit('open', {file: 'channels/SampleVideo_1280x720_1mb.mp4'})" value="ABC">
    </div>
    
    <div class="pc-controls">
      <div class="favorites-list">favorites list</div>
      <div class="text-input">
        <input id="text-input" type="text" placeholder="type here...">
      </div>
      <div class="controls">
        <div class="side-btns">
          <div class="btn" onclick="emit('nav', 'back')">
            <i class="material-icons">&#xE5CB;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'refresh')">
            <i class="material-icons">&#xE5D5;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'zoomIn')">
            <i class="material-icons">&#xE8FF;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'zoomOut')">
            <i class="material-icons">&#xE900;</i>
          </div>
        </div>
        <div class="touch-pad"></div>
        <div class="side-btns">
          <div class="btn" onclick="emit('nav', 'forward')">
            <i class="material-icons">&#xE5CC;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'search')">
            <i class="material-icons">&#xE8B6;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'scrollUp')">
            <i class="material-icons">&#xE5D8;</i>
          </div>
          <div class="btn" onclick="emit('nav', 'scrollDown')">
            <i class="material-icons">&#xE5DB;</i>
          </div>
        </div>
      </div>
    </div>

  </div>
 
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js"></script>
  <script type="text/javascript" src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
 
  <script>
    var socket = io.connect(window.location.host)

    // Find the right method, call on correct element
    function launchIntoFullscreen(element) {
      if(element.requestFullscreen) {
        element.requestFullscreen()
      } else if(element.mozRequestFullScreen) {
        element.mozRequestFullScreen()
      } else if(element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen()
      } else if(element.msRequestFullscreen) {
        element.msRequestFullscreen()
      }
    }

    $(document).on('click', function() {
      console.log('click')
      launchIntoFullscreen(document.documentElement)
    })
    
    $(function() {
      FastClick.attach(document.body);
    })
    
    var xPrev = 0
    var yPrev = 0

    var touchRelease = true

    var scrollPrev = 0

    var filterFirstMove = true
    
    $('.pc-controls').hide()
    


    var emit = function (message, data) {
      console.log(message, data)
      if(data.url) {
        $('.app-list').slideUp()
        $('.pc-controls').slideDown()
      } else if (data === 'search') {
        $("#text-input").focus()
      }
      socket.emit(message, data)
    }
    
    $('#controls').click(function () {
      $('.app-list').slideUp()
      $('.pc-controls').slideDown()
    })
    
    $('#apps').click(function () {
      $('.app-list').slideDown()
      $('.pc-controls').slideUp()
    })

    $(document).on('touchmove', function (e) {
      e.originalEvent.preventDefault()
    })
    
    $(document).on('touchstart', '.touch-pad', function(e) {

      touchRelease = false

      setTimeout(function(){
        if (touchRelease
          && e.originalEvent.touches[0].clientX === xPrev
          && e.originalEvent.touches[0].clientY === yPrev) {
          socket.emit('mouseClick')
        }        
      }, 100)
      
      xPrev = e.originalEvent.touches[0].clientX
      yPrev = e.originalEvent.touches[0].clientY
    })

    $(document).on('touchmove', '.touch-pad', function (e) {
      console.log( 'ontouchmove' )
      e.originalEvent.preventDefault()
      
      var dx = e.originalEvent.touches[0].clientX - xPrev
      var dy = e.originalEvent.touches[0].clientY - yPrev

      xPrev = e.originalEvent.touches[0].clientX
      yPrev = e.originalEvent.touches[0].clientY

      if (!filterFirstMove) {
        socket.emit("touchMove", { dx: dx, dy: dy })
      } else {
        filterFirstMove = false
      }
     
    })
    
    $(document).on('touchend', '.touch-pad', function (e) {
      console.log( 'touchend' )
      touchRelease = true
      filterFirstMove = true
    })

    
    // $(document).on('touchstart', '.scroll', function (e) {
    //   console.log("scroll start")
    //   scrollPrev = e.originalEvent.touches[0].clientY
    // })

    // $(document).on('touchmove', '.scroll', function (e) {
    //   console.log("scroll")
    //   e.originalEvent.preventDefault()
      
    //   if (e.originalEvent.touches[0].clientY - scrollPrev > 0) {
    //     socket.emit("scroll", 1)
    //   } else {
    //     socket.emit("scroll", -1)
    //   }
      
    //   scrollPrev = e.originalEvent.touches[0].clientY
    // })
    
    $("#text-input").keyup(function (e) {
      var key = String.fromCharCode(e.keyCode)
      if(e.keyCode === 13) {
        $("#text-input").val('').blur()
        key = 'enter'
      } else if (e.keyCode === 8) {
        key = 'backspace'
      }
      console.log(key)
      socket.emit("type", key)
    })

  </script>

</body>

</html>